<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Learning Locker Documentation</title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Documentation for Learning Locker, the open source learning record store.">
    <link rel="canonical" href="http://learninglocker.net/statements/">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/tomorrow-night.css">
    <link rel="stylesheet" href="/css/docs.css">

    <script async="" src="//www.google-analytics.com/analytics.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-941797-7', 'learninglocker.net');
        ga('send', 'pageview');

    </script>
    <script type="text/javascript">
        function prettyCode() {
            var tables = document.getElementsByTagName('table');
            for (index = 0; index < tables.length; ++index) {
                tables[index].className = "table table-default table-bordered";
            }
        }
    </script>
</head>


    <body onload="prettyCode();">

    <div class="docs-masthead">
    <div class="container">
        <img src="/images/logo-small.png" class="logo">
        <nav class="docs-nav pull-right">
            <a class="docs-nav-item" href="http://learninglocker.net">Website</a>
            <a class="docs-nav-item" href="https://github.com/learninglocker">Github</a>
            <a class="docs-nav-item" href="https://github.com/learninglocker/docs">Edit</a>
        </nav>
    </div>
</div>
<div class="banner">
    <div class="container">
        <div class="docs-header">
            <h1 class="docs-title">Learning Locker Documentation</h1>
            <p class="lead docs-description"> Documentation for Learning Locker, the open source learning record store.</p>
        </div>
    </div>
</div>


    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-3 docs-sidebar">
                <div class="sidebar-title top">
                    Overview
                </div>
                <ul class="nav">
                    <li><a href="/">Welcome</a></li>
                    <li><a href="/contributors">Contributors</a></li>
                </ul>
                <div class="sidebar-title">
                    Getting Started
                </div>
                <ul class="nav">
                    <li><a href="/requirements">Requirements</a></li>
                    <li><a href="/installation">Installation</a></li>
                    <li><a href="/troubleshooting">Troubleshooting</a></li>
                    <li><a href="/upgrading">Upgrading</a></li>
                </ul>
                <div class="sidebar-title">
                    Development
                </div>
                <ul class="nav">
                    <li><a href="/statements">xAPI Statements</a></li>
                    <li><a href="/extending">Extending LL</a></li>
                    <li><a href="/development">Dev Projects</a></li>
                    <li><a href="/reporting_api">Reporting API</a></li>
                </ul>
                <div class="sidebar-title">
                    User Manual
                </div>
                <ul class="nav">
                    <li><a href="/administration">Administration</a></li>
                    <li><a href="/reporting">Reporting tool</a></li>
                </ul>
                <div class="sidebar-title">
                    Get Involved
                </div>
                <ul class="nav">
                    <li><a href="/contribute">Contributing</a></li>
                    <li><a href="/issues">Reporting Issues</a></li>
                    <li><a href="/translation">Translations</a></li>
                </ul>
            </div>
            <div class="col-xs-12 col-sm-8 docs-main">
                <h1 id="xapi-statements">xAPI Statements</h1>

<ul>
  <li><a href="#basicauth">Basic Auth</a></li>
  <li><a href="#structure">Structure</a></li>
  <li><a href="#indexes">Indexes</a></li>
  <li><a href="#quirks">Quirks</a></li>
</ul>

<h2 id="basic-auth">Basic Auth</h2>

<p>The primary way to submit and retrieve statements from a Learning Locker LRS is via http Basic Authentication. Upon creation each LRS generates a unique key / secret which pair as the username / password. You can reset these values at any time in the LRS setting page.</p>

<blockquote>
  <p>It is important to make sure you employ SSL on production sites using basic auth and never share your key / secret</p>
</blockquote>

<p>If your get 401 unauthorized requests in your calls to xAPI then It is posible you have some module config striping the Authorization header, usually for
“security reasons”. You can work around this issue by passing the header directly to PHP via the env in your apache default config or your virtual host:</p>

<pre><code>&lt;VirtualHost *&gt;
  ...
  SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1
  ...
&lt;/VirtualHost&gt;
</code></pre>

<h2 id="structure">Structure</h2>

<p>Learning Locker stores xAPI statements as MongoDB documents. The actual collection is named statements. To access the statement collection use the following command in your Mongo client terminal.</p>

<pre><code>db.statements.find().pretty()
</code></pre>

<p>Each statement document contains the following top level keys: _id, lrs, statement.</p>

<p><strong>_id</strong></p>

<p>This is the unique MongoDB _id that is automattically asigned to each incoming statement.</p>

<p><strong>lrs</strong></p>

<p>Holds details of the LRS the statement in question belongs to. There are two keys here: _id and name. In this case _id refers to the LRS document _id.</p>

<p><strong>statement</strong></p>

<p>This contains the actual statement as submitted to the LRS.</p>

<p><strong>timestamp</strong></p>

<p>This is the statement timestamp converted into MongoDate for use in Mongo’s aggregation function.</p>

<h3 id="example">Example</h3>

<pre><code>{
  "_id": ObjectId("8u87y98r9e809i0ir"),
  "lrs": {
    "_id": "8u7y6t5r4e67",
    "name": "A sample LRS"
  },
  "statement": {
    "actor": {
      "mbox": "someone@somewhere.com",
      "name": "Billy Smith"
    },
    "verb": {
      "id": "http://adlnet.gov/expapi/verbs/answered",
      "display": {
        "en-US" : "answered"
      }
    },
    "object":{
      "id":"http://example.adlnet.gov/xapi/example/simpleCBT",
      "definition":{
          "name":{
              "en-US":"simple CBT course"
          },
          "description":{
              "en-US":"A fictitious example CBT course."
          }
      }
    },
    "id": "9a38f6f0-f74c-40c9-a6a7-243eba85eff2",
    "stored": "2014-05-21T11:51:19.742400+00:00"
  },
  "timestamp": ISODate()
}
</code></pre>

<h2 id="indexes">Indexes</h2>

<p>With MongoDB you can, and should, set indexes in collections you will be querying a lot, in this case, the statements collection. You can read more about MongoDB indexes at the following links:</p>

<ul>
  <li><a href="http://docs.mongodb.org/manual/indexes/">Indexes</a></li>
  <li><a href="http://docs.mongodb.org/manual/administration/indexes/">Indexing tutorials</a></li>
</ul>

<p>For v1.0 of Learning Locker we have set the following indexes on a statements document:</p>

<ul>
  <li>lrs._id</li>
  <li>lrs._id &amp; statement.object.id</li>
  <li>lrs._id &amp; statement.verb.id</li>
  <li>lrs._id &amp; statement.actor.mbox</li>
</ul>

<blockquote>
  <p>It should be noted that this is only a first pass at indexing statements. This needs full testing and revision to make sure we can optimise querying. So, if you have any suggestions then <a href="http://docs.learninglocker.net/contribute">please get involved</a> and help out. Thanks.</p>
</blockquote>

<h2 id="quirks">Quirks</h2>

<h4 id="full-stops-in-keys">Full stops in keys</h4>

<p>MongoDB doesn’t allow full stops (.) in keys. Therefore, we replace all full stops with &amp;46; when saving statements. This does mean, to display the full statement on the site and before sending via the API we need to replace &amp;46; throughout with the full stop using a simple function:</p>

<pre><code>//scan array and replace &amp;46; with . (This is a result of . being reserved in Mongo)
//convert array to json as this is faster for multi-dimensional arrays (?) @todo check this out.
function replaceHtmlEntity( $array ){`
    return json_decode(str_replace('&amp;46;','.', json_encode($array)));
}
</code></pre>

            </div>
        </div>
    </div>

    <footer class="docs-footer">
    <p>Learning Locker and the Squirrel logo are copyright HT2, 2014 | Learning Locker is licensed under GPL 3.0.</p>
    <p>
        <a href="#">Back to top</a>
    </p>
</footer>


    </body>
</html>
